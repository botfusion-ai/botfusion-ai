<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BotFusion AI</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root {
  --dark-bg: #1e1e2f;
  --dark-secondary: #2a2a3d;
  --dark-text: #e0e0e0;
  --light-bg: #ffffff;
  --light-text: #111111;
}

body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: var(--dark-bg);
  color: var(--dark-text);
  transition: all 0.3s;
}

header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 15px;
  background: var(--dark-secondary);
}

.hamburger {
  font-size: 24px;
  cursor: pointer;
}

header h1 {
  margin: 0;
  font-size: 20px;
}

header button {
  margin-left: 10px;
  padding: 5px 10px;
  cursor: pointer;
}

#sidebar {
  position: fixed;
  top: 0;
  left: -250px;
  width: 250px;
  height: 100%;
  background: var(--dark-secondary);
  transition: 0.3s;
  padding-top: 50px;
  box-shadow: 2px 0 5px rgba(0,0,0,0.5);
  z-index: 10;
}

#sidebar.active { left: 0; }

#sidebar button {
  width: 90%;
  margin: 10px auto;
  display: block;
  padding: 10px;
  background: #333;
  border: none;
  color: var(--dark-text);
  cursor: pointer;
  border-radius: 5px;
  text-align: left;
}

#sidebar button:hover { background: #444; }

#chatArea {
  margin-left: 0;
  padding: 10px;
  transition: margin-left 0.3s;
}

#chatArea.active { margin-left: 250px; }

#messages {
  height: calc(100vh - 180px);
  overflow-y: auto;
  padding: 10px;
  background: var(--dark-bg);
}

.message {
  margin: 5px 0;
  padding: 8px 12px;
  border-radius: 10px;
  max-width: 80%;
}

.userMsg { background: #3a3a4d; margin-left: auto; }
.botMsg { background: #44445a; margin-right: auto; }

#typing {
  font-style: italic;
  margin: 5px;
  display: none;
}

#chatInput {
  display: flex;
  padding: 10px;
  background: var(--dark-secondary);
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  box-sizing: border-box;
}

#chatInput input {
  flex: 1;
  padding: 10px;
  border-radius: 5px;
  border: none;
  margin-right: 5px;
  background: #333;
  color: var(--dark-text);
}

#chatInput button {
  padding: 10px 15px;
  border-radius: 5px;
  border: none;
  background: #4a90e2;
  color: #fff;
  cursor: pointer;
}

#settingsPanel {
  display: none;
  margin-top: 10px;
  padding: 10px;
  background: var(--dark-secondary);
}

#settingsPanel label {
  display: block;
  margin: 10px 0 5px;
}

select, input[type="checkbox"] {
  padding: 5px;
}

#sidebar img { width: 30px; margin-right: 5px; vertical-align: middle; }
</style>
</head>

<body>
<header>
  <span class="hamburger" onclick="toggleSidebar()">☰</span>
  <h1>BotFusion AI</h1>
  <div>
    <button onclick="toggleTheme()">Theme</button>
    <button id="loginBtn" onclick="googleLogin()">Login</button>
  </div>
</header>

<div id="sidebar">
  <button onclick="newChat()">New Chat</button>
  <button onclick="showAccount()">Account</button>
  <button onclick="showSettings()">Settings</button>
  <button onclick="summarizeChat()">Summarize</button>
  <button onclick="analyzeChat()">Analyze</button>
  <button onclick="makeList()">Make List</button>
  <button onclick="generateImage()">Generate Image</button>
  <button onclick="logout()">Logout</button>
</div>

<div id="chatArea">
  <div id="messages"></div>
  <div id="typing">Bot is typing...</div>
</div>

<div id="chatInput">
  <input type="text" id="message" placeholder="Type a message..." />
  <button onclick="sendMessage()">Send</button>
</div>

<div id="settingsPanel">
  <label for="languageSelect">Language:</label>
  <select id="languageSelect">
    <option value="en">English</option>
    <option value="hi">Hindi</option>
  </select>
  <label>
    Dark Theme:
    <input type="checkbox" id="themeToggle" onchange="toggleTheme()" checked>
  </label>
</div>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDA62eN5MEjX9Z-gw6w9UuR8L-Ke_6J7eE",
  authDomain: "botfusion-ai-bd6d0.firebaseapp.com",
  projectId: "botfusion-ai-bd6d0",
  storageBucket: "botfusion-ai-bd6d0.firebasestorage.app",
  messagingSenderId: "730477136598",
  appId: "1:730477136598:web:c6b4e0d495744d12079777",
  measurementId: "G-53FTWNQB8X"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const messagesDiv = document.getElementById('messages');
const typingDiv = document.getElementById('typing');

// Sidebar toggle
function toggleSidebar(){
  document.getElementById('sidebar').classList.toggle('active');
  document.getElementById('chatArea').classList.toggle('active');
}

// Theme toggle
function toggleTheme(){
  const isDark = document.getElementById('themeToggle').checked;
  if(isDark){
    document.body.style.background = "#1e1e2f";
    document.body.style.color = "#e0e0e0";
  } else {
    document.body.style.background = "#ffffff";
    document.body.style.color = "#111";
  }
}

// Add message
function addMessage(text,sender){
  const div=document.createElement('div');
  div.classList.add('message',sender==='user'?'userMsg':'botMsg');
  div.textContent=text;
  messagesDiv.appendChild(div);
  messagesDiv.scrollTop=messagesDiv.scrollHeight;
}

// Language dictionary
const translations = {
  'en': { reply: 'Bot reply to:' },
  'hi': { reply: 'बॉट का जवाब:' }
};

function getCurrentLanguage(){
  return document.getElementById('languageSelect').value;
}

// Send message
async function sendMessage(){
  const input=document.getElementById('message');
  if(!input.value) return;
  const msg=input.value;
  addMessage(msg,'user');
  input.value='';
  typingDiv.style.display='block';

  const user=auth.currentUser;
  const uid=user?user.uid:'guest';
  await db.collection('chats').add({
    uid,
    sender:'user',
    message: msg,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });

  setTimeout(async ()=>{
    const lang = getCurrentLanguage();
    const botPrefix = translations[lang].reply;
    const botReply = `${botPrefix} "${msg}"`;
    addMessage(botReply,'bot');
    typingDiv.style.display='none';

    await db.collection('chats').add({
      uid,
      sender:'bot',
      message: botReply,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
  },1200);
}

// Helper to get last user message
function getLastUserMessage(){
  const allMsgs = messagesDiv.querySelectorAll('.userMsg');
  if(allMsgs.length===0) return null;
  return allMsgs[allMsgs.length-1].textContent;
}

// Generic API call
async function callAPI(endpoint, message, action){
  try{
    const response = await fetch(endpoint, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({message, action})
    });
    const data = await response.json();
    return data.reply || data.url || 'No response';
  }catch(err){
    console.error(err);
    return '⚠️ Error connecting to server';
  }
}

// Action buttons
async function summarizeChat(){ const msg=getLastUserMessage(); if(!msg)return; addMessage(await callAPI('/api/chat',msg,'summarize'),'bot'); }
async function analyzeChat(){ const msg=getLastUserMessage(); if(!msg)return; addMessage(await callAPI('/api/chat',msg,'analyze'),'bot'); }
async function makeList(){ const msg=getLastUserMessage(); if(!msg)return; addMessage(await callAPI('/api/chat',msg,'list'),'bot'); }
async function generateImage(){ const msg=getLastUserMessage(); if(!msg)return; const res=await callAPI('/api/image',msg); const img=document.createElement('img'); img.src=res.url; img.style.maxWidth='100%'; messagesDiv.appendChild(img); messagesDiv.scrollTop=messagesDiv.scrollHeight; }

// Menu actions
function newChat(){ messagesDiv.innerHTML=''; }
function showSettings(){ document.getElementById('settingsPanel').style.display='block'; }
function showAccount(){ const user=auth.currentUser; if(user){ alert(`Logged in as: ${user.displayName} (${user.email})`); } else { alert('Not logged in'); } }
async function logout(){ await auth.signOut(); alert('Logged out'); }

// Google login
async function googleLogin(){
  const provider=new firebase.auth.GoogleAuthProvider();
  try{
    const result=await auth.signInWithPopup(provider);
    const user=result.user;
    document.getElementById('loginBtn').textContent='Logged in';
    alert(`Logged in as: ${user.displayName} (${user.email})`);
  }catch(e){ alert(e.message); }
}

// Load chat history
auth.onAuthStateChanged(user=>{
  if(user){
    document.getElementById('loginBtn').textContent='Logged in';
    db.collection('chats')
      .where('uid','==',user.uid)
      .orderBy('timestamp')
      .get()
      .then(snapshot=>{
        snapshot.forEach(doc=>{
          addMessage(doc.data().message,doc.data().sender);
        });
      });
  }
});
</script>
</body>
</html>
